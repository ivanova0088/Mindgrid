<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MindGrid</title>

  <!-- ÙƒØ³Ø± ÙƒØ§Ø´ Ø¨Ø³ÙŠØ· Ù„Ù„Ù€ CSS -->
  <script>
    (function () {
      const usp = new URLSearchParams(location.search);
      const v = usp.get('v') || 'mg_repub';
      const cb = usp.get('cb') || Date.now().toString().slice(-6);
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = `styles.css?v=${encodeURIComponent(v)}&cb=${cb}`;
      document.write(link.outerHTML);
      // Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù‚ÙŠÙ… Ù…ØªØ§Ø­Ø© Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø©
      window.__MG_VER__ = v; window.__MG_CB__ = cb;
    })();
  </script>

  <style>
    /* Ù„Ù…Ø³Ø§Øª Ø®ÙÙŠÙØ© ÙÙŠ Ø­Ø§Ù„ Ù„Ù… ÙŠÙØ­Ù…Ù‘Ù„ styles.css */
    :root{--bg:#f6fbff;--card:#ffffff;--txt:#0f172a;--muted:#64748b;--brand:#0ea5e9;--ok:#10b981;--warn:#f59e0b}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic","Noto Naskh Arabic",Tahoma,sans-serif;color:var(--txt)}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:#fff;box-shadow:0 1px 8px rgba(0,0,0,.06);position:sticky;top:0;z-index:5}
    header .title{font-weight:800;letter-spacing:.3px}
    header .badge{font-size:12px;color:var(--muted)}
    main{max-width:900px;margin:20px auto;padding:0 14px}
    .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 24px rgba(2,6,23,.06);margin-bottom:16px}
    .row{display:flex;gap:14px;flex-wrap:wrap}
    .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#e2e8f0;color:#0f172a}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .title-lg{font-size:22px;font-weight:800;margin:0 0 6px}
    .muted{color:var(--muted);font-size:14px}
    .hidden{display:none !important}
    .note{padding:10px 12px;border-radius:10px;background:#f8fafc;border:1px dashed #cbd5e1;color:var(--muted);font-size:14px}
  </style>
</head>

<body>
  <header>
    <div class="title">ğŸ§  MindGrid</div>
    <div class="badge" id="verBadge">â€”</div>
  </header>

  <main id="app">
    <section class="card">
      <h2 class="title-lg">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
      <p class="muted">Ø§Ø®ØªØ± Ù†Ù…Ø· Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø§Ø·Ø¹Ø©.</p>
    </section>

    <section class="card">
      <div class="row">
        <div style="flex:1 1 280px">
          <h3 class="title-lg">Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© â­•</h3>
          <p class="muted">Ø£Ù‚ÙˆØ§Ø³ Ø¯Ø§Ø¦Ø±ÙŠØ© ØªØªÙ‚Ø§Ø·Ø¹ â€” ØªØ¬Ø±Ø¨Ø© Ù…Ø®ØªÙ„ÙØ© ÙˆÙ…Ø±ÙŠØ­Ø© Ù„Ù„Ø¹ÙŠÙ†.</p>
          <div class="row">
            <button class="btn" id="startOrbit">Ø§Ø¨Ø¯Ø£</button>
            <button class="btn secondary" id="checkOrbit">ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø§Ù„Ø­Ø²Ù…Ø©</button>
          </div>
          <div class="note hidden" id="orbitNote"></div>
        </div>

        <div style="flex:1 1 280px">
          <h3 class="title-lg">Ø§Ù„Ø³ÙÙ‘Ù„ÙÙ‘Ù… ğŸªœ</h3>
          <p class="muted">Ø£Ø¹Ù…Ø¯Ø© ÙƒÙ„Ù…Ø§Øª ØªØ±Ø¨Ø·Ù‡Ø§ Ø¯Ø±Ø¬Ø§Øª â€” Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ø±ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„.</p>
          <div class="row">
            <button class="btn" id="startLadder">Ø§Ø¨Ø¯Ø£</button>
            <button class="btn secondary" id="checkLadder">ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø§Ù„Ø­Ø²Ù…Ø©</button>
          </div>
          <div class="note hidden" id="ladderNote"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="muted">Ù†ØµÙŠØ­Ø©: Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª 404ØŒ ØªØ£ÙƒÙ‘Ø¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ:
        <code>Content/orbit/packs/starter.json</code> Ùˆ
        <code>js/orbit.js</code>ØŒ
        <code>js/ladder.js</code>.
      </div>
    </section>
  </main>

  <script>
    // Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø©
    function cacheBust(url) {
      const v = encodeURIComponent(window.__MG_VER__ || 'mg_repub');
      const cb = encodeURIComponent(window.__MG_CB__ || Date.now());
      const sep = url.includes('?') ? '&' : '?';
      return `${url}${sep}v=${v}&cb=${cb}`;
    }
    function loadScript(src) {
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = cacheBust(src); s.defer = true; s.onload = res; s.onerror = () => rej(new Error('SCRIPT_404 ' + src));
        document.head.appendChild(s);
      });
    }
    function setNote(id, msg, ok) {
      const el = document.getElementById(id);
      el.textContent = msg;
      el.classList.remove('hidden');
      el.style.borderColor = ok ? 'var(--ok)' : '#cbd5e1';
      el.style.color = ok ? '#065f46' : 'var(--muted)';
      el.style.background = ok ? '#ecfdf5' : '#f8fafc';
    }
    function hideNote(id){ document.getElementById(id).classList.add('hidden'); }

    // Ø´Ø§Ø±Ø© Ø§Ù„Ø¥ØµØ¯Ø§Ø±
    document.getElementById('verBadge').textContent = `Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯: ${window.__MG_VER__} Â· cb=${window.__MG_CB__}`;

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­ÙØ²Ù…
    async function checkJSON(path) {
      const r = await fetch(cacheBust(path), { cache: 'no-store' });
      if (!r.ok) throw new Error('HTTP_' + r.status);
      return r.json();
    }

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ­Øµ
    document.getElementById('checkOrbit').onclick = async () => {
      hideNote('orbitNote');
      try {
        const data = await checkJSON('Content/orbit/packs/starter.json');
        setNote('orbitNote', `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø© âœ” (${(data?.puzzles||[]).length || 'ØŸ'} Ù„ØºØ²)`, true);
      } catch (e) {
        setNote('orbitNote', 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©. Ø£Ù†Ø´Ø¦ Ø§Ù„Ù…Ù„Ù: Content/orbit/packs/starter.json', false);
      }
    };
    document.getElementById('checkLadder').onclick = async () => {
      hideNote('ladderNote');
      try {
        const data = await checkJSON('Content/ladder/packs/starter.json');
        setNote('ladderNote', `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø© âœ” (${(data?.puzzles||[]).length || 'ØŸ'} Ù„ØºØ²)`, true);
      } catch (e) {
        setNote('ladderNote', 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø²Ù…Ø©. Ø£Ù†Ø´Ø¦ Ø§Ù„Ù…Ù„Ù: Content/ladder/packs/starter.json', false);
      }
    };

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø·
    async function startOrbit() {
      hideNote('orbitNote');
      try {
        const [_, pack] = await Promise.all([
          loadScript('js/orbit.js'),
          checkJSON('Content/orbit/packs/starter.json')
        ]);
        if (window.MG_Orbit && typeof window.MG_Orbit.mount === 'function') {
          window.MG_Orbit.mount(document.getElementById('app'), pack);
        } else {
          setNote('orbitNote', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…Ø© Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ MG_Orbit.mount Ø¯Ø§Ø®Ù„ js/orbit.js', false);
        }
      } catch (e) {
        setNote('orbitNote', 'ØªØ¹Ø°Ù‘Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù…Ø·: ' + e.message, false);
      }
    }
    async function startLadder() {
      hideNote('ladderNote');
      try {
        const [_, pack] = await Promise.all([
          loadScript('js/ladder.js'),
          checkJSON('Content/ladder/packs/starter.json')
        ]);
        if (window.MG_Ladder && typeof window.MG_Ladder.mount === 'function') {
          window.MG_Ladder.mount(document.getElementById('app'), pack);
        } else {
          setNote('ladderNote', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…Ø© Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ MG_Ladder.mount Ø¯Ø§Ø®Ù„ js/ladder.js', false);
        }
      } catch (e) {
        setNote('ladderNote', 'ØªØ¹Ø°Ù‘Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù…Ø·: ' + e.message, false);
      }
    }

    document.getElementById('startOrbit').onclick = startOrbit;
    document.getElementById('startLadder').onclick = startLadder;

    // ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Ø¹Ø§Ù…Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    loadScript('js/library.js').catch(()=>{ /* ØºÙŠØ± Ø­Ø±ÙØ¬ */ });
  </script>
</body>
</html>

<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MindGrid – الكلمات المتقاطعة</title>
  <link rel="stylesheet" href="styles.css?v=mgcw_fixA">
  <style>
    body{background:#0F172A;color:#E5E7EB;font-family:system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:960px;margin:24px auto;padding:16px}
    .card{background:#111827;border:1px solid #1F2937;border-radius:14px;padding:16px}
    .ok{background:#064e3b;color:#d1fae5;border-radius:10px;padding:10px 12px;margin-bottom:12px;display:none}
    .warn{background:#3f1d1d;color:#fecaca;border-radius:10px;padding:10px 12px;margin-bottom:12px;display:none}
    #cw-root{min-height:220px;display:flex;align-items:center;justify-content:center;border:1px dashed #334155;border-radius:12px;margin-top:12px}
    .btn{background:#0ea5e9;color:#002233;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>🧠 MindGrid <small id="tag" style="font-size:14px;opacity:.8">mgcw_fixA</small></h1>

    <div id="msgOk" class="ok">تم تحميل السكربتات بنجاح. سنبدأ الآن…</div>
    <div id="msgWarn" class="warn"></div>

    <div class="card">
      <p style="margin:0 0 8px">منطقة اللعب:</p>
      <div id="cw-root">…سيتم التهيئة…</div>
      <div style="margin-top:12px"><button class="btn" id="btnStart">ابدأ يدويًا</button></div>
    </div>
  </div>

  <!-- تحميل السكربتات بالترتيب الصحيح — بدون type="module" -->
  <script src="js/library.js?v=mgcw_fixA" defer></script>
  <script src="js/core.js?v=mgcw_fixA" defer></script>
  <script src="js/ui.js?v=mgcw_fixA" defer></script>
  <script src="js/crossword_canvas.js?v=mgcw_fixA" defer></script>

  <!-- فحص سريع + تشغيل -->
  <script>
    const ok = s => { const el = document.getElementById('msgOk'); el.style.display='block'; if(s) el.textContent = s; };
    const warn = s => { const el = document.getElementById('msgWarn'); el.style.display='block'; el.textContent = s; };

    window.addEventListener('DOMContentLoaded', () => {
      const tryStart = () => {
        if (!window.MG) { warn('MG غير معرّف. تأكّد أن library.js يُحمَّل أولاً وبدون type="module".'); return; }
        if (typeof window.startCrosswordCanvas !== 'function') {
          warn('الدالة startCrosswordCanvas غير موجودة. تأكّد من js/crossword_canvas.js واسمه بشرطة سفلية.');
          return;
        }
        ok('تم التحميل — نبدأ اللعبة الآن.');
        try { window.startCrosswordCanvas({ mount:'#cw-root' }); }
        catch(e){ warn('استثناء أثناء البدء: ' + e.message); console.error(e); }
      };

      // زر تشغيل يدوي للمساعدة في التشخيص
      document.getElementById('btnStart').addEventListener('click', tryStart);

      // تشغيل تلقائي بعد لحظات كي تضمن تحميل كل defer
      setTimeout(tryStart, 50);
    });
  </script>
</body>
</html>
